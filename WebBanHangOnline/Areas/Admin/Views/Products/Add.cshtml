@model WebBanHangOnline.Models.EF.Product
@{ ViewBag.Title = "Thêm mới sản phẩm";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml"; }

<!-- Content wrapper -->
<div class="content-wrapper">
    <!-- Content -->

    <div class="container-xxl flex-grow-1 container-p-y">
        <h4 class="fw-bold py-3 mb-4"><span class="text-muted fw-light">Forms /</span> Basic Inputs</h4>
        @using (Html.BeginForm("Add", "Products", FormMethod.Post, new { id = "product-form", @data_parsley_validate = "Vui lòng nhập đầy đủ thông tin" }))
        {
            @Html.AntiForgeryToken()
            @Html.ValidationSummary(true)

            <div class="row">
                <!-- Input Sizing -->
                <div class="col-md-6">
                    <div class="card mb-4">
                        <h5 class="card-header">@ViewBag.Title</h5>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="defaultInput" class="form-label">Tên sản phẩm</label>
                                <input id="defaultInput" class="form-control" type="text" placeholder="Tên sản phẩm" required data-parsley-required-message="Phần này không được để trống!" />
                            </div>
                            <div class="mb-3">
                                <label for="defaultInput" class="form-label">Mã sản phẩm</label>
                                <input id="defaultInput" class="form-control" type="text" placeholder="Mã sản phẩm" required data-parsley-required-message="Phần này không được để trống!" />
                            </div>
                            <div class="mb-3">
                                <label for="defaultSelect" class="form-label">Danh mục sản phẩm</label>
                                @Html.DropDownListFor(x => x.ProductCategoryId, ViewBag.ProductCategory as SelectList, "- Chọn danh mục sản phẩm -", new { @class = "form-select", @required = "required", @data_parsley_trigger = "change", @rows = "5" })
                            </div>
                            <div class="mb-3">
                                <label for="exampleFormControlTextarea1" class="form-label">Giới thiệu ngắn về sản phẩm</label>
                                <textarea class="form-control" id="exampleFormControlTextarea1" rows="6" required data-parsley-required-message="Phần này không được để trống!"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="exampleFormControlInput1" class="form-label">Chi tiết sản phẩm</label>
                                @Html.TextAreaFor(x => x.Detail, new { @class = "form-control", @id = "txtDetail", @required = "required" })
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Input Sizing -->
                <div class="col-md-6">
                    <div class="card mb-4">
                        <h5 class="card-header">@ViewBag.Title</h5>
                        <div class="card-body">
                            <div class="card">
                                <h5 class="card-header">Table Basic</h5>
                                <div class="table-responsive text-nowrap">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>Hình ảnh</th>
                                                <th>Chọn làm ảnh đại diện</th>
                                            </tr>
                                        </thead>
                                        <tbody class="table-border-bottom-0">
                                            <tr>
                                                <td><i class="fab fa-angular fa-lg text-danger me-3"></i> <strong>Angular Project</strong></td>
                                                <td>Albert Cook</td>
                                                <td>
                                                    <ul class="list-unstyled users-list m-0 avatar-group d-flex align-items-center">
                                                        <li data-bs-toggle="tooltip"
                                                            data-popup="tooltip-custom"
                                                            data-bs-placement="top"
                                                            class="avatar avatar-xs pull-up"
                                                            title="Lilian Fuller">
                                                            <img src="../assets/img/avatars/5.png" alt="Avatar" class="rounded-circle" />
                                                        </li>
                                                    </ul>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="defaultInput" class="form-label">Số lượng</label>
                                <input id="defaultInput" name="Quantity" class="form-control" type="text" placeholder="Số lượng" required data-parsley-required-message="Phần này không được để trống!" />
                            </div>
                            <div class="mb-3">
                                <label for="defaultInput" class="form-label">Giá bán ra</label>
                                <input id="demoPrice" name="demoPrice" class="form-control" type="text" placeholder="Giá bán ra" required data-parsley-required-message="Phần này không được để trống!" />
                            </div>
                            <div class="mb-3">
                                <label for="defaultInput" class="form-label">Giá nhập vào</label>
                                <input id="OriginalPrice" name="demoOriginalPrice" class="form-control" type="text" placeholder="Giá nhập vào" required data-parsley-required-message="Phần này không được để trống!" />
                            </div>
                            <div class="mb-3">
                                <label for="defaultInput" class="form-label">Giá khuyến mãi</label>
                                <input id="demoPriceSale" name="demoPriceSale" class="form-control" type="text" placeholder="Giá khuyến mãi" required data-parsley-required-message="Phần này không được để trống!" />
                            </div>
                            <div class="row gy-3">
                                <div class="col-md">
                                    <div class="form-check mt-3">
                                        <input class="form-check-input" type="checkbox" value="" id="defaultCheck1" checked required data-parsley-required-message="Phần này không được để trống!" />
                                        <label class="form-check-label" for="defaultCheck1"> Hiển thị tất cả các trang </label>
                                    </div>
                                    <div class="form-check mt-3">
                                        <input class="form-check-input" type="checkbox" value="" id="defaultCheck1" />
                                        <label class="form-check-label" for="defaultCheck1"> Hiển thị trang chủ  </label>
                                    </div>
                                    <div class="form-check mt-3">
                                        <input class="form-check-input" type="checkbox" value="" id="defaultCheck1" />
                                        <label class="form-check-label" for="defaultCheck1"> Hiển thị trang khuyến mại </label>
                                    </div>
                                    <div class="form-check mt-3">
                                        <input class="form-check-input" type="checkbox" value="" id="defaultCheck1" />
                                        <label class="form-check-label" for="defaultCheck1"> Hiển thị trang nổi bật </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="demo-inline-spacing">
                                <a href="/admin/products" type="button" class="btn rounded-pill btn-outline-secondary">Trở lại</a>
                                <button type="submit" class="btn rounded-pill btn-outline-success">Thêm mới</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
        <!-- / Content -->

    </div>
    <!-- Content wrapper -->
</div>

@section  scripts{
    @*<script>
        $(document).ready(function () {
            $('#product-form').parsley();

            $('#product-form').on('submit', function (e) {
                if (!$(this).parsley().isValid()) {
                    e.preventDefault(); // chặn submit nếu chưa hợp lệ
                }
            });
        });

        $(document).ready(function () {
            $('.auto').autoNumeric('init');
            $('#demoPrice').bind('blur focusout keypress keyup', function () {
                var demoGet = $('#demoPrice').autoNumeric('get');
                $('#Price').val(demoGet);
                $('#Price').autoNumeric('set', demoGet);
            });
            $('#demoPriceSale').bind('blur focusout keypress keyup', function () {
                var demoGet = $('#demoPriceSale').autoNumeric('get');
                $('#PriceSale').val(demoGet);
                $('#PriceSale').autoNumeric('set', demoGet);
            });
            $('#demoOriginalPrice').bind('blur focusout keypress keyup', function () {
                var demoGet = $('#demoOriginalPrice').autoNumeric('get');
                $('#OriginalPrice').val(demoGet);
                $('#OriginalPrice').autoNumeric('set', demoGet);
            });
            CKEDITOR.replace('txtDetail', {
                customConfig: '/content/ckeditor/config.js',
                extraAllowedContent: 'span',
            });

            $('body').on('click', '.btnXoaAnh', function () {
                var conf = confirm('Bạn có muốn xóa ảnh này không?');
                if (conf === true) {
                    var _id = $(this).data('id');
                    $('#trow_' + _id).fadeTo('fast', 0.5, function () {
                        $(this).slideUp('fast', function () { $(this).remove(); });
                    });
                    var temp = $('#tCurrentId').val();
                    var currentId = parseInt(temp) - 1;
                    $('#tCurrentId').val(currentId);
                }
            });
        });
        function BrowseServer(field) {
            var finder = new CKFinder();
            finder.selectActionFunction = function (fileUrl) {
                addImageProduct(fileUrl);
            };
            finder.popup();
        }
        function addImageProduct(url) {
            var temp = $('#tCurrentId').val();
            var currentId = parseInt(temp) + 1;
            var str = "";
            if (currentId == 1) {
                str += `<tr id="trow_${currentId}">
                        <td class="text-center">${currentId}</td>
                        <td class="text-center"><img width="80" src="${url}" /> <input type='hidden' value="${url}" name="Images"/></td>
                        <td class="text-center"><input type="radio" name="rDefault" value="${currentId}" checked="checked"/></td>
                        <td class="text-center"><a href="#" data-id="${currentId}" class="btn btn-sm btn-danger btnXoaAnh">Xóa</a></td>
                        </tr>`;
            }
            else {
                str += `<tr id="trow_${currentId}">
                        <td class="text-center">${currentId}</td>
                        <td class="text-center"><img width="80" src="${url}" /> <input type='hidden' value="${url}" name="Images"/></td>
                        <td class="text-center"><input type="radio" name="rDefault" value="${currentId}"/></td>
                        <td class="text-center"><a href="#" data-id="${currentId}" class="btn btn-sm btn-danger btnXoaAnh">Xóa</a></td>
                        </tr>`;
            }
            $('#tbHtml').append(str);
            $('#tCurrentId').val(currentId);
            //$('#tbHtml tr td a').each(function () {
            //    $(this).click(function () {
            //        var conf = confirm('Bạn có muốn xóa ảnh này không?');
            //        if (conf === true) {
            //            var _id = $(this).data('id');
            //            $('#trow_' + _id).fadeTo('fast',1, function () {
            //                $(this).slideUp('fast', function () { $(this).remove(); });
            //            });
            //            var temp = $('#tCurrentId').val();
            //            var currentId = parseInt(temp) - 1;
            //            $('#tCurrentId').val(currentId);
            //            }
            //        });
            //    });
        }

    </script>*@
    <script>
        $(document).ready(function () {
            // Khởi tạo AutoNumeric
            new AutoNumeric('#demoPrice', { decimalPlaces: 0 });
            new AutoNumeric('#demoPriceSale', { decimalPlaces: 0 });
            new AutoNumeric('#demoOriginalPrice', { decimalPlaces: 0 });

            // Cập nhật giá trị ẩn khi form submit
            $('#product-form').on('submit', function (e) {
                // Lấy và gán giá trị từ AutoNumeric vào các input ẩn
                $('#Price').val(AutoNumeric.getAutoNumericElement('#demoPrice').getNumber());
                $('#PriceSale').val(AutoNumeric.getAutoNumericElement('#demoPriceSale').getNumber());
                $('#OriginalPrice').val(AutoNumeric.getAutoNumericElement('#demoOriginalPrice').getNumber());

                // Kiểm tra validation
                if (!$(this).parsley().isValid()) {
                    e.preventDefault(); // Ngăn submit nếu chưa hợp lệ
                    showAlert('Vui lòng nhập đầy đủ thông tin!', 'danger');
                }
            });

            //// ParsleyJS khởi tạo
            //$('#product-form').parsley();
        });
        $(document).ready(function () {
            $('#product-form').parsley();

            $('#product-form').on('submit', function (e) {
                if (!$(this).parsley().isValid()) {
                    e.preventDefault(); // chặn submit nếu chưa hợp lệ
                }
            });
        });

    </script>
}